---
import "../styles/abonnement.css";

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { fetchAbonnementSection } from '../lib/supabase.js';

// Fetch content from Supabase
const allContent = await fetchAbonnementSection('hero');
const hero = allContent.length > 0 ? allContent[0] : null;

const features = await fetchAbonnementSection('features');
---

<BaseLayout>
  <Header />

  <div class="page">
    <main class="container">
      <!-- VENSTRE: BILLEDE -->
      <div class="imageBox">
        <img src="/pic.png" alt="SoundWheel app mockup" />
      </div>

      <!-- HØJRE: DYNAMISK ABONNEMENT -->
      <section class="subBox">
        {hero ? (
          <>
            <p class="small-label">Fra</p>
            <p class="price">49 kr. / mdr</p>
            <p class="trial">14 dages gratis prøveperiode</p>

            <h2>{hero.title}</h2>
            <p>{hero.body}</p>
          </>
        ) : (
          <>
            <p class="small-label">Fra</p>
            <p class="price">49 kr. / mdr</p>
            <p class="trial">14 dages gratis prøveperiode</p>
            <h2>Abonnement</h2>
          </>
        )}

        {features.length ? (
          <>
            <h3>Funktioner</h3>
            {features.map(f => (
              <div>
                {f.title ? <h4>{f.title}</h4> : null}
                {f.body ? <p>{f.body}</p> : null}
                {f.list_items ? (
                  <ul>
                    {f.list_items.map((item: string) => <li>{item}</li>)}
                  </ul>
                ) : null}
              </div>
            ))}
          </>
        ) : null}

        <div class="buttonWrapper">
          <button class="startBtn">Start prøveperiode</button>
        </div>
      </section>
    </main>

    <Footer />
  </div>
</BaseLayout>