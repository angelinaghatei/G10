---
import "../styles/abonnement.css";

import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { fetchAbonnement } from '../lib/supabase.js';


const allData = await fetchAbonnement();


const hero = allData.find(item => item.section === 'hero') || null;
const features = allData.filter(item => item.section === 'features');

// Debug output
console.log('=== SUPABASE DEBUG ===');
console.log('All data:', JSON.stringify(allData, null, 2));
console.log('Hero data:', JSON.stringify(hero, null, 2));
console.log('Features count:', features.length);
console.log('=====================');
---

<BaseLayout>
  <Header />

  <div class="page">
    <main class="container">
      <!-- VENSTRE: BILLEDE -->
      <div class="imageBox">
        <img src="/pic.png" alt="SoundWheel app mockup" />
      </div>

      <!-- HØJRE: DYNAMISK ABONNEMENT -->
      <section class="subBox">
        {hero ? (
          <>
            <h2>{hero.title}</h2>
            <p>{hero.body}</p>
          </>
        ) : (
          <p>Indlæser abonnement data...</p>
        )}

        {features.length > 0 && (
          <>
            <h3>Funktioner</h3>
            {features.map(f => (
              <div>
                {f.title && <h4>{f.title}</h4>}
                {f.body && <p>{f.body}</p>}
                {f.list_items && f.list_items.length > 0 && (
                  <ul>
                    {f.list_items.map((item: string) => <li>{item}</li>)}
                  </ul>
                )}
              </div>
            ))}
          </>
        )}

        <div class="buttonWrapper">
          <button class="startBtn">Start prøveperiode</button>
        </div>
      </section>
    </main>

    <Footer />
  </div>
</BaseLayout>